<!DOCTYPE html><html lang="en" theme-mode="dark"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>2025-11-23-canvas项目相关-快捷键管理 | Notes|笔记站</title><link rel="icon" type="image/x-icon" href="/Arknight-notes/favicon.ico"><link rel="preload" as="font" crossorigin="anonymous" href="/Arknight-notes/font/Bender.ttf"><link rel="preload" as="font" crossorigin="anonymous" href="/Arknight-notes/font/BenderLight.ttf"><link rel="preload" as="font" crossorigin="anonymous" href="/Arknight-notes/font/JetBrainsMono-Regular.woff2"><link rel="stylesheet" href="/Arknight-notes/css/arknights.css"><style>@font-face {
  font-family: Bender;
  src: local('Bender'), url("/Arknight-notes/font/Bender.ttf"), url("/Arknight-notes/font/Bender.otf");
}
@font-face {
  font-family: BenderLight;
  src: local('BenderLight'), url("/Arknight-notes/font/BenderLight.ttf");
}
@font-face {
  font-family: 'JetBrains Mono';
  src: local('JetBrains Mono'), url('/Arknight-notes/font/JetBrainsMono-Regular.woff2') format('woff2');
}
</style><script>var config = {"root":"/Arknight-notes/","code_fold":90,"search":{"preload":false,"activeHolder":"键入以继续","blurHolder":"数据检索","noResult":"无 $0 相关数据"},"code":{"codeInfo":"$0 - $1 行","copy":"复制"}}</script><link type="text/css" rel="stylesheet" href="/Arknight-notes/lib/encrypt/hbe.style.css"><script src="/Arknight-notes/js/gitalk.js"></script><script src="//unpkg.com/mermaid@10.5.0/dist/mermaid.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.6.1/MathJax.js"></script><script>MathJax.Hub.Config({
 menuSettings: {
   zoom: "None"
 },
 showMathMenu: false,
 jax: ["input/TeX","output/CommonHTML"],
 extensions: ["tex2jax.js"],
 TeX: {
   extensions: ["AMSmath.js","AMSsymbols.js"],
   equationNumbers: {
     autoNumber: "AMS"
   }
 },
 tex2jax: {
   inlineMath: [["\\(", "\\)"]],
   displayMath: [["\\[", "\\]"]]
 }
});</script><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lightgallery.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-zoom.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-thumbnail.css"><link type="text/css" rel="stylesheet" href="/Arknight-notes/lib/fontawesome/css/all.min.css"><script>if (window.localStorage.getItem('theme-mode') === 'light')
 document.documentElement.setAttribute('theme-mode', 'light')
if (window.localStorage.getItem('theme-mode') === 'dark')
 document.documentElement.setAttribute('theme-mode', 'dark')</script><style>@font-face {
 font-family: BenderLight;
 src: local('Bender'), url("/Arknight-notes/font/BenderLight.woff2") format('woff2');
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/Arknight-notes/font/JetBrainsMono-Regular.woff2') format('woff2');
}</style><style>:root {
 --dark-background: url('https://pic2.zhimg.com/v2-6269d74b4dafe14781d03790e5a86b21_r.jpg');
 --light-background: url('https://pic1.zhimg.com/v2-233b64b583642fc4a6d77e69ced33150_r.jpg');
 --theme-encrypt-confirm: '确认'
}</style><script defer src="/Arknight-notes/js/arknights.js"></script><script defer src="/Arknight-notes/js/search.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script async src="/Arknight-notes/js/gitalk.js"></script><script defer type="module">import mermaid from '//unpkg.com/mermaid@10.5.0/dist/mermaid.esm.mjs';
window.mermaid = mermaid;
code.paintMermaid();
</script><script src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.6.1/MathJax.js"></script><script>MathJax.Hub.Config({
  menuSettings: {
    zoom: "None"
  },
  showMathMenu: false,
  jax: ["input/TeX","output/CommonHTML"],
  extensions: ["tex2jax.js"],
  TeX: {
    extensions: ["AMSmath.js","AMSsymbols.js"],
    equationNumbers: {
      autoNumber: "AMS"
    }
  },
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]]
  }
});
</script><script async src="//unpkg.com/lightgallery@2.7.1/lightgallery.min.js"></script><script async src="//unpkg.com/lightgallery@2.7.1/plugins/zoom/lg-zoom.min.js"></script><script async src="//unpkg.com/lightgallery@2.7.1/plugins/thumbnail/lg-thumbnail.min.js"></script><script async src="/Arknight-notes/lib/encrypt/hbe.js"></script><script async src="/Arknight-notes/js/pjax.js"></script><script class="pjax-js">reset= () => {gitalk = new Gitalk({
 clientID: 'Ov23ct13Fb0b67x23wnT',
 clientSecret: 'f18ce69dd545e3c0f5e2456afde9c756fe8a254a',
 repo: 'Arknight-notes',
 owner: 'Zhongye1',
 admin: ['Zhongye1'],
 distractionFreeMode: false,
 id: location.pathname
});
if (document.querySelector("#gitalk")) gitalk.render("gitalk");document.querySelector('.lg-container')?.remove()
lightGallery(document.getElementById('post-bg'), {
  plugins: [lgZoom,lgThumbnail],
  selector: '.item-img'})}</script><script>window.addEventListener("load",() => {pjax = new Pjax({
 cacheBust: false,
 selectors: ['title','article','#aside-block','.pjax-js','data-pjax','.busuanzi'],
 switches: {'article': Pjax.switches.sideBySide},
 switchesOptions: {
   'article': {
     classNames: {
       remove: "pjax-out",
       add: "pjax-in"
     }
   }
 }
});
document.addEventListener("pjax:complete", reset);document.addEventListener('pjax:success', _ => bszCaller.fetch(
 "//busuanzi.ibruce.info/busuanzi?jsonpCallback=BusuanziCallback", a => {
  bszTag.texts(a),
  bszTag.shows()
}));reset()})</script><script class="pjax-js">reset= () => {gitalk = new Gitalk({
 clientID: 'Ov23ct13Fb0b67x23wnT',
 clientSecret: 'f18ce69dd545e3c0f5e2456afde9c756fe8a254a',
 repo: 'Arknight-notes',
 owner: 'Zhongye1',
 admin: ['Zhongye1'],
 distractionFreeMode: false,
 id: location.pathname
});
if (document.querySelector("#gitalk")) gitalk.render("gitalk");document.querySelector('.lg-container')?.remove()
lightGallery(document.getElementById('post-bg'), {
  plugins: [lgZoom,lgThumbnail],
  selector: '.item-img'})}</script><script>window.addEventListener("load",() => {pjax = new Pjax({
 cacheBust: false,
 selectors: ['title','article','#aside-block','.pjax-js'],
 switches: {'article': Pjax.switches.sideBySide},
 switchesOptions: {
   'article': {
     classNames: {
       remove: "pjax-out",
       add: "pjax-in"
     }
   }
 }
});
document.addEventListener("pjax:complete", reset);reset()})</script><meta name="generator" content="Hexo 7.3.0"><style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style><link rel="alternate" href="/Arknight-notes/rss.xml" title="Notes|笔记站" type="application/atom+xml">
</head><body><div class="loading" style="opacity: 0;"><div class="loadingBar left"></div><div class="loadingBar right"></div></div><main><header class="closed"><div class="navBtn"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><nav><div class="navItem" id="search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="数据检索" spellcheck="false" maxlength="50" type="text" id="search-input"></span></div><div class="navItem" id="search-holder"></div><div class="search-popup" tabindex="0"><div id="search-result"></div></div><ol class="navContent"><li class="navItem"><a class="navBlock" href="/Arknight-notes/"><span class="navItemTitle">Home</span></a></li><li class="navItem" matchdata="categories,tags"><a class="navBlock" href="/Arknight-notes/archives/"><span class="navItemTitle">Archives</span></a></li><li class="navItem"><a class="navBlock" href="/Arknight-notes/about/"><span class="navItemTitle">About</span></a></li></ol></nav></header><article><div id="post-bg"><div id="post-title"><h1>2025-11-23-canvas项目相关-快捷键管理</h1><div id="post-info"><span>文章发布时间: <div class="control"><time datetime="2025-11-23T12:11:21.000Z" id="date"> 2025-11-23</time></div></span><br><span>最后更新时间: <div class="control"><time datetime="2025-11-23T12:11:57.716Z" id="updated"> 2025-11-23</time></div></span><br><span id="busuanzi_container_page_pv">页面浏览: <span class="control" id="busuanzi_value_page_pv">加载中...</span></span></div></div><hr><div id="post-content"><h2 id="1-模块摘要"><a href="#1-模块摘要" class="headerlink" title="1. 模块摘要"></a>1. 模块摘要</h2><h3 id="1-1-核心职责"><a href="#1-1-核心职责" class="headerlink" title="1.1 核心职责"></a>1.1 核心职责</h3><p>快捷键管理模块负责处理画布应用中的各种键盘快捷键操作，包括撤销/重做、元素操作（删除、复制、粘贴）以及工具切换等核心功能。该模块通过监听键盘事件，提供直观、高效的用户交互方式。</p>
<h3 id="1-2-项目结构"><a href="#1-2-项目结构" class="headerlink" title="1.2 项目结构"></a>1.2 项目结构</h3><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs nix">src<span class="hljs-symbol">/</span><br>├── hooks<span class="hljs-symbol">/</span><br>│   ├── useHotkeysManagement.ts        <span class="hljs-comment"># 撤销/重做快捷键管理</span><br>│   └── use_React_hotkeys_management.ts <span class="hljs-comment"># 画布操作快捷键管理</span><br>└── stores<span class="hljs-symbol">/</span><br>    └── canvasStore.ts                 <span class="hljs-comment"># 提供快捷键操作对应的状态管理方法</span><br></code></pre></td></tr></table></figure>
<h3 id="1-3-技术栈"><a href="#1-3-技术栈" class="headerlink" title="1.3 技术栈"></a>1.3 技术栈</h3><ul>
<li><code>react-hotkeys-hook</code>：用于监听和处理键盘快捷键的 React Hook</li>
<li><code>Zustand</code>：全局状态管理，提供操作实现方法</li>
<li><code>TypeScript</code>：类型安全</li>
</ul>
<h2 id="2-类型定义"><a href="#2-类型定义" class="headerlink" title="2. 类型定义"></a>2. 类型定义</h2><p>项目中没有专门定义快捷键相关的类型，但使用了以下接口：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">UseCanvasShortcutsProps</span> {<br>  <span class="hljs-attr">stageManagerRef</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">RefObject</span>&lt;<span class="hljs-title class_">StageManager</span> | <span class="hljs-literal">null</span>&gt;;<br>}<br></code></pre></td></tr></table></figure>
<h2 id="3-核心状态管理"><a href="#3-核心状态管理" class="headerlink" title="3. 核心状态管理"></a>3. 核心状态管理</h2><p>快捷键管理模块本身不维护独立状态，而是依赖于 canvasStore 中的状态：</p>
<ul>
<li><code>selectedIds</code>：当前选中的元素 ID 列表</li>
<li><code>clipboard</code>：复制的元素数据</li>
<li><code>pasteOffset</code>：粘贴时的偏移量计数</li>
<li><code>tool</code>：当前选择的工具类型</li>
</ul>
<h2 id="4-逻辑流程"><a href="#4-逻辑流程" class="headerlink" title="4. 逻辑流程"></a>4. 逻辑流程</h2><h3 id="4-1-整体架构"><a href="#4-1-整体架构" class="headerlink" title="4.1 整体架构"></a>4.1 整体架构</h3><p>快捷键管理采用两个自定义 Hook 分别处理不同类型的快捷键操作：</p>
<ol>
<li><a href="file:///e:/ADF-workbase/BDdraw_DEV/src/hooks/useHotkeysManagement.ts#L5-L27">useHotkeysManagement</a>：专门处理撤销/重做快捷键</li>
<li><a href="file:///e:/ADF-workbase/BDdraw_DEV/src/hooks/use_React_hotkeys_management.ts#L10-L180">useCanvasShortcuts</a>：处理画布操作相关快捷键</li>
</ol>
<h3 id="4-2-快捷键注册与处理流程"><a href="#4-2-快捷键注册与处理流程" class="headerlink" title="4.2 快捷键注册与处理流程"></a>4.2 快捷键注册与处理流程</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs mermaid">graph TB<br>    A[初始化快捷键Hook] --&gt; B[调用useHotkeys注册快捷键]<br>    B --&gt; C[监听键盘事件]<br>    C --&gt; D{匹配快捷键?}<br>    D --&gt;|是| E[执行回调函数]<br>    D --&gt;|否| C<br>    E --&gt; F[调用canvasStore对应方法]<br>    F --&gt; G[更新状态并触发重渲染]<br></code></pre></td></tr></table></figure>
<h2 id="5-核心函数解析"><a href="#5-核心函数解析" class="headerlink" title="5. 核心函数解析"></a>5. 核心函数解析</h2><h3 id="5-1-useHotkeysManagement-Hook"><a href="#5-1-useHotkeysManagement-Hook" class="headerlink" title="5.1 useHotkeysManagement Hook"></a>5.1 useHotkeysManagement Hook</h3><p>该 Hook 专门处理撤销/重做相关的快捷键操作。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">useHotkeysManagement</span> = (<span class="hljs-params"></span>) =&gt; {<br>  <span class="hljs-keyword">const</span> { undo, redo } = <span class="hljs-title function_">useStore</span>();<br><br>  <span class="hljs-comment">// Ctrl+Z 撤销</span><br>  <span class="hljs-title function_">useHotkeys</span>(<br>    <span class="hljs-string">"ctrl+z"</span>,<br>    <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {<br>      event.<span class="hljs-title function_">preventDefault</span>();<br>      <span class="hljs-title function_">undo</span>();<br>    },<br>    {},<br>    [undo]<br>  );<br><br>  <span class="hljs-comment">// Ctrl+Shift+Z 或 Ctrl+Y 重做</span><br>  <span class="hljs-title function_">useHotkeys</span>(<br>    <span class="hljs-string">"ctrl+y, ctrl+shift+z"</span>,<br>    <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {<br>      event.<span class="hljs-title function_">preventDefault</span>();<br>      <span class="hljs-title function_">redo</span>();<br>    },<br>    {},<br>    [redo]<br>  );<br>};<br></code></pre></td></tr></table></figure>
<p>主要特点：</p>
<ul>
<li>监听 <code>Ctrl+Z</code> 组合键触发撤销操作</li>
<li>监听 <code>Ctrl+Y</code> 或 <code>Ctrl+Shift+Z</code> 组合键触发重做操作</li>
<li>使用 <a href="file:///e:/ADF-workbase/BDdraw_DEV/node_modules/@types/react/index.d.ts#L3010-L3010">event.preventDefault()</a> 阻止浏览器默认行为</li>
<li>依赖 canvasStore 提供的 <a href="file:///e:/ADF-workbase/BDdraw_DEV/src/stores/canvasStore.ts#L281-L281">undo</a> 和 <a href="file:///e:/ADF-workbase/BDdraw_DEV/src/stores/canvasStore.ts#L282-L282">redo</a> 方法</li>
</ul>
<h3 id="5-2-useCanvasShortcuts-Hook"><a href="#5-2-useCanvasShortcuts-Hook" class="headerlink" title="5.2 useCanvasShortcuts Hook"></a>5.2 useCanvasShortcuts Hook</h3><p>该 Hook 处理画布操作相关的快捷键，包括元素操作和工具切换。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">useCanvasShortcuts</span> = (<span class="hljs-params">{</span><br><span class="hljs-params">  stageManagerRef,</span><br><span class="hljs-params">}: <span class="hljs-title class_">UseCanvasShortcutsProps</span></span>) =&gt; {<br>  <span class="hljs-keyword">const</span> { selectedIds, removeElements, setTool, copyElements, pasteElements } =<br>    <span class="hljs-title function_">useStore</span>();<br><br>  <span class="hljs-comment">// 删除选中元素</span><br>  <span class="hljs-title function_">useHotkeys</span>(<br>    <span class="hljs-string">"delete, backspace"</span>,<br>    <span class="hljs-function">() =&gt;</span> {<br>      <span class="hljs-keyword">if</span> (selectedIds.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {<br>        <span class="hljs-title function_">removeElements</span>(selectedIds);<br>      }<br>    },<br>    {<br>      <span class="hljs-attr">enableOnFormTags</span>: <span class="hljs-literal">false</span>,<br>      <span class="hljs-attr">ignoreEventWhen</span>: <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> event.<span class="hljs-property">target</span> <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">HTMLInputElement</span>,<br>    },<br>    [selectedIds, removeElements]<br>  );<br><br>  <span class="hljs-comment">// 复制元素</span><br>  <span class="hljs-title function_">useHotkeys</span>(<br>    <span class="hljs-string">"ctrl+c, cmd+c"</span>,<br>    <span class="hljs-function">() =&gt;</span> {<br>      <span class="hljs-keyword">if</span> (selectedIds.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {<br>        <span class="hljs-title function_">copyElements</span>(selectedIds);<br>      }<br>    },<br>    {<br>      <span class="hljs-attr">enableOnFormTags</span>: <span class="hljs-literal">false</span>,<br>      <span class="hljs-attr">ignoreEventWhen</span>: <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> event.<span class="hljs-property">target</span> <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">HTMLInputElement</span>,<br>    },<br>    [selectedIds, copyElements]<br>  );<br><br>  <span class="hljs-comment">// 粘贴元素</span><br>  <span class="hljs-title function_">useHotkeys</span>(<br>    <span class="hljs-string">"ctrl+v, cmd+v"</span>,<br>    <span class="hljs-function">() =&gt;</span> {<br>      <span class="hljs-title function_">pasteElements</span>();<br>    },<br>    {<br>      <span class="hljs-attr">enableOnFormTags</span>: <span class="hljs-literal">false</span>,<br>      <span class="hljs-attr">ignoreEventWhen</span>: <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> event.<span class="hljs-property">target</span> <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">HTMLInputElement</span>,<br>    },<br>    [pasteElements]<br>  );<br><br>  <span class="hljs-comment">// 工具切换快捷键 (Shift+1 到 Shift+0)</span><br>  <span class="hljs-title function_">useHotkeys</span>(<br>    <span class="hljs-string">"shift+1"</span>,<br>    <span class="hljs-function">() =&gt;</span> {<br>      <span class="hljs-title function_">setTool</span>(<span class="hljs-string">"select"</span>);<br>    },<br>    {<br>      <span class="hljs-attr">enableOnFormTags</span>: <span class="hljs-literal">false</span>,<br>      <span class="hljs-attr">ignoreEventWhen</span>: <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> event.<span class="hljs-property">target</span> <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">HTMLInputElement</span>,<br>    },<br>    [setTool]<br>  );<br>  <span class="hljs-comment">// ... 其他工具切换快捷键</span><br>};<br></code></pre></td></tr></table></figure>
<p>主要功能包括：</p>
<ol>
<li><p><strong>元素删除</strong>：</p>
<ul>
<li>快捷键：<code>Delete</code> 或 <code>Backspace</code></li>
<li>条件：有选中的元素</li>
<li>操作：调用 <a href="file:///e:/ADF-workbase/BDdraw_DEV/src/stores/canvasStore.ts#L271-L277">removeElements</a> 删除选中元素</li>
</ul>
</li>
<li><p><strong>元素复制</strong>：</p>
<ul>
<li>快捷键：<code>Ctrl+C</code> (Windows) 或 <code>Cmd+C</code> (Mac)</li>
<li>条件：有选中的元素</li>
<li>操作：调用 <a href="file:///e:/ADF-workbase/BDdraw_DEV/src/stores/canvasStore.ts#L257-L262">copyElements</a> 将选中元素复制到剪贴板</li>
</ul>
</li>
<li><p><strong>元素粘贴</strong>：</p>
<ul>
<li>快捷键：<code>Ctrl+V</code> (Windows) 或 <code>Cmd+V</code> (Mac)</li>
<li>操作：调用 <a href="file:///e:/ADF-workbase/BDdraw_DEV/src/stores/canvasStore.ts#L263-L280">pasteElements</a> 从剪贴板粘贴元素</li>
</ul>
</li>
<li><p><strong>工具切换</strong>：</p>
<ul>
<li><code>Shift+1</code>：切换到选择工具</li>
<li><code>Shift+2</code>：切换到矩形工具</li>
<li><code>Shift+3</code>：切换到菱形工具</li>
<li><code>Shift+4</code>：切换到圆形工具</li>
<li><code>Shift+5</code>：切换到箭头工具</li>
<li><code>Shift+6</code>：切换到直线工具</li>
<li><code>Shift+7</code>：切换到铅笔工具</li>
<li><code>Shift+8</code>：切换到文字工具</li>
<li><code>Shift+9</code>：切换到图像工具</li>
<li><code>Shift+0</code>：切换到橡皮擦工具</li>
</ul>
</li>
</ol>
<p>配置参数说明：</p>
<ul>
<li><a href="file:///e:/ADF-workbase/BDdraw_DEV/node_modules/react-hotkeys-hook/dist/useHotkeys.d.ts#L7-L7">enableOnFormTags</a>：设置为 <code>false</code> 表示在表单元素上不启用快捷键</li>
<li><a href="file:///e:/ADF-workbase/BDdraw_DEV/node_modules/react-hotkeys-hook/dist/useHotkeys.d.ts#L8-L8">ignoreEventWhen</a>：当目标元素是 HTMLInputElement 时不处理事件，防止在输入框中使用快捷键</li>
</ul>
<h2 id="6-快捷键操作实现"><a href="#6-快捷键操作实现" class="headerlink" title="6. 快捷键操作实现"></a>6. 快捷键操作实现</h2><h3 id="6-1-撤销-重做操作"><a href="#6-1-撤销-重做操作" class="headerlink" title="6.1 撤销/重做操作"></a>6.1 撤销/重做操作</h3><p>撤销/重做操作通过调用 canvasStore 中的 <a href="file:///e:/ADF-workbase/BDdraw_DEV/src/stores/canvasStore.ts#L281-L281">undo</a> 和 <a href="file:///e:/ADF-workbase/BDdraw_DEV/src/stores/canvasStore.ts#L282-L282">redo</a> 方法实现，这些方法进一步委托给 <a href="file:///e:/ADF-workbase/BDdraw_DEV/src/lib/UndoRedoManager.ts#L171-L171">undoRedoManager</a> 实例处理。</p>
<h3 id="6-2-元素操作"><a href="#6-2-元素操作" class="headerlink" title="6.2 元素操作"></a>6.2 元素操作</h3><p>元素操作包括删除、复制和粘贴：</p>
<ol>
<li><p><strong>删除操作</strong>：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-attr">removeElements</span>: <span class="hljs-function">(<span class="hljs-params">ids</span>) =&gt;</span><br>  <span class="hljs-title function_">originalSet</span>(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> {<br>    <span class="hljs-keyword">const</span> newElements = { ...state.<span class="hljs-property">elements</span> };<br>    ids.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">id</span>) =&gt;</span> <span class="hljs-keyword">delete</span> newElements[id]);<br>    <span class="hljs-keyword">return</span> { <span class="hljs-attr">elements</span>: newElements, <span class="hljs-attr">selectedIds</span>: [] };<br>  });<br></code></pre></td></tr></table></figure>
</li>
<li><p><strong>复制操作</strong>：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-attr">copyElements</span>: <span class="hljs-function">(<span class="hljs-params">ids</span>) =&gt;</span><br>  <span class="hljs-title function_">originalSet</span>(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> {<br>    <span class="hljs-keyword">const</span> elementsToCopy = ids<br>      .<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">id</span>) =&gt;</span> state.<span class="hljs-property">elements</span>[id])<br>      .<span class="hljs-title function_">filter</span>(<span class="hljs-title class_">Boolean</span>);<br>    <span class="hljs-keyword">return</span> { <span class="hljs-attr">clipboard</span>: elementsToCopy };<br>  });<br></code></pre></td></tr></table></figure>
</li>
<li><p><strong>粘贴操作</strong>：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-attr">pasteElements</span>: <span class="hljs-function">() =&gt;</span><br>  <span class="hljs-title function_">originalSet</span>(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> {<br>    <span class="hljs-keyword">if</span> (!state.<span class="hljs-property">clipboard</span> || state.<span class="hljs-property">clipboard</span>.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> state;<br><br>    <span class="hljs-comment">// 增加粘贴偏移量</span><br>    <span class="hljs-keyword">const</span> newOffset = state.<span class="hljs-property">pasteOffset</span> + <span class="hljs-number">1</span>;<br><br>    <span class="hljs-keyword">const</span> <span class="hljs-attr">newElements</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">CanvasElement</span>&gt; = {};<br>    <span class="hljs-keyword">const</span> <span class="hljs-attr">newIds</span>: <span class="hljs-built_in">string</span>[] = [];<br><br>    state.<span class="hljs-property">clipboard</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">element</span>) =&gt;</span> {<br>      <span class="hljs-keyword">const</span> newId = <span class="hljs-title function_">nanoid</span>();<br>      <span class="hljs-keyword">const</span> randomSign = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() &gt; <span class="hljs-number">0.5</span> ? <span class="hljs-number">1</span> : -<span class="hljs-number">1</span>; <span class="hljs-comment">// 随机选择正负</span><br>      <span class="hljs-keyword">const</span> randomOffset = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">20</span>; <span class="hljs-comment">// 0-20的随机偏移量</span><br>      newIds.<span class="hljs-title function_">push</span>(newId);<br>      newElements[newId] = {<br>        ...element,<br>        <span class="hljs-attr">id</span>: newId,<br>        <span class="hljs-comment">// 每次粘贴都在前一次的基础上继续偏移</span><br>        <span class="hljs-attr">x</span>: element.<span class="hljs-property">x</span> + randomOffset * randomSign,<br>        <span class="hljs-attr">y</span>: element.<span class="hljs-property">y</span> + randomOffset * randomSign,<br>      };<br>    });<br><br>    <span class="hljs-keyword">return</span> {<br>      <span class="hljs-attr">elements</span>: { ...state.<span class="hljs-property">elements</span>, ...newElements },<br>      <span class="hljs-attr">selectedIds</span>: newIds,<br>      <span class="hljs-attr">pasteOffset</span>: newOffset,<br>    };<br>  });<br></code></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="6-3-工具切换"><a href="#6-3-工具切换" class="headerlink" title="6.3 工具切换"></a>6.3 工具切换</h3><p>工具切换通过调用 canvasStore 的 <a href="file:///e:/ADF-workbase/BDdraw_DEV/src/stores/canvasStore.ts#L255-L255">setTool</a> 方法实现，更新当前选择的工具类型并清除选中状态。</p>
<h2 id="7-特殊处理与优化"><a href="#7-特殊处理与优化" class="headerlink" title="7. 特殊处理与优化"></a>7. 特殊处理与优化</h2><h3 id="7-1-表单元素兼容性处理"><a href="#7-1-表单元素兼容性处理" class="headerlink" title="7.1 表单元素兼容性处理"></a>7.1 表单元素兼容性处理</h3><p>为了避免在输入框等表单元素中意外触发快捷键，所有快捷键都配置了以下选项：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs typescript">{<br>  <span class="hljs-attr">enableOnFormTags</span>: <span class="hljs-literal">false</span>,<br>  <span class="hljs-attr">ignoreEventWhen</span>: <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> event.<span class="hljs-property">target</span> <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">HTMLInputElement</span>,<br>}<br></code></pre></td></tr></table></figure>
<h3 id="7-2-粘贴偏移处理"><a href="#7-2-粘贴偏移处理" class="headerlink" title="7.2 粘贴偏移处理"></a>7.2 粘贴偏移处理</h3><p>为了区分多次粘贴的元素，每次粘贴时会给新元素添加一个随机偏移量：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">const</span> randomSign = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() &gt; <span class="hljs-number">0.5</span> ? <span class="hljs-number">1</span> : -<span class="hljs-number">1</span> <span class="hljs-comment">// 随机选择正负</span><br><span class="hljs-keyword">const</span> randomOffset = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">20</span> <span class="hljs-comment">// 0-20的随机偏移量</span><br><span class="hljs-comment">// ...</span><br><span class="hljs-attr">x</span>: element.<span class="hljs-property">x</span> + randomOffset * randomSign,<br><span class="hljs-attr">y</span>: element.<span class="hljs-property">y</span> + randomOffset * randomSign,<br></code></pre></td></tr></table></figure>
<div id="paginator"></div></div><div id="post-footer"><div id="pages"><div class="footer-link" style="width: 50%;text-align:right;border-right:1px #fe2 solid"><a href="/Arknight-notes/posts/38567.html">← 下一篇 2025-11-23-canvas项目相关-画布元素控制调整机制</a></div><div class="footer-link" style="width: 50%;right:1px;border-left:1px #fe2 solid"><a href="/Arknight-notes/posts/36977.html">2025-11-23-canvas项目相关-工具栏选择机制 上一篇 →</a></div></div></div><div id="comments"><div id="gitalk"></div></div></div><div class="bottom-btn"><div><a class="i-top" id="to-top" onClick="scrolls.scrolltop();" title="回到顶部" style="opacity: 0; display: none;">∧ </a><a class="i-index" id="to-index" href="#toc-div" title="文章目录">≡</a><a class="i-color" id="color-mode" onClick="colorMode.change()" title="切换主题"></a></div></div></article><aside><div id="about"><a href="/Arknight-notes/" id="logo"><img src="https://pic4.zhimg.com/80/v2-d9884f32711e19e80979eac58e943897_720w.webp" alt="Logo" style="margin:20;border-radius:0;"></a><h1 id="Dr"><a href="zhongye">柊野</a></h1><div id="description"><p></p></div></div><div id="aside-block"><div id="toc-div"><h1>目录</h1><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E6%A8%A1%E5%9D%97%E6%91%98%E8%A6%81"><span class="toc-number">1.</span> <span class="toc-text">1. 模块摘要</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E6%A0%B8%E5%BF%83%E8%81%8C%E8%B4%A3"><span class="toc-number">1.1.</span> <span class="toc-text">1.1 核心职责</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84"><span class="toc-number">1.2.</span> <span class="toc-text">1.2 项目结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-%E6%8A%80%E6%9C%AF%E6%A0%88"><span class="toc-number">1.3.</span> <span class="toc-text">1.3 技术栈</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E7%B1%BB%E5%9E%8B%E5%AE%9A%E4%B9%89"><span class="toc-number">2.</span> <span class="toc-text">2. 类型定义</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E6%A0%B8%E5%BF%83%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86"><span class="toc-number">3.</span> <span class="toc-text">3. 核心状态管理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E9%80%BB%E8%BE%91%E6%B5%81%E7%A8%8B"><span class="toc-number">4.</span> <span class="toc-text">4. 逻辑流程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84"><span class="toc-number">4.1.</span> <span class="toc-text">4.1 整体架构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E5%BF%AB%E6%8D%B7%E9%94%AE%E6%B3%A8%E5%86%8C%E4%B8%8E%E5%A4%84%E7%90%86%E6%B5%81%E7%A8%8B"><span class="toc-number">4.2.</span> <span class="toc-text">4.2 快捷键注册与处理流程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E6%A0%B8%E5%BF%83%E5%87%BD%E6%95%B0%E8%A7%A3%E6%9E%90"><span class="toc-number">5.</span> <span class="toc-text">5. 核心函数解析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-useHotkeysManagement-Hook"><span class="toc-number">5.1.</span> <span class="toc-text">5.1 useHotkeysManagement Hook</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-useCanvasShortcuts-Hook"><span class="toc-number">5.2.</span> <span class="toc-text">5.2 useCanvasShortcuts Hook</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E5%BF%AB%E6%8D%B7%E9%94%AE%E6%93%8D%E4%BD%9C%E5%AE%9E%E7%8E%B0"><span class="toc-number">6.</span> <span class="toc-text">6. 快捷键操作实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-%E6%92%A4%E9%94%80-%E9%87%8D%E5%81%9A%E6%93%8D%E4%BD%9C"><span class="toc-number">6.1.</span> <span class="toc-text">6.1 撤销&#x2F;重做操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-%E5%85%83%E7%B4%A0%E6%93%8D%E4%BD%9C"><span class="toc-number">6.2.</span> <span class="toc-text">6.2 元素操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-%E5%B7%A5%E5%85%B7%E5%88%87%E6%8D%A2"><span class="toc-number">6.3.</span> <span class="toc-text">6.3 工具切换</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E7%89%B9%E6%AE%8A%E5%A4%84%E7%90%86%E4%B8%8E%E4%BC%98%E5%8C%96"><span class="toc-number">7.</span> <span class="toc-text">7. 特殊处理与优化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-%E8%A1%A8%E5%8D%95%E5%85%83%E7%B4%A0%E5%85%BC%E5%AE%B9%E6%80%A7%E5%A4%84%E7%90%86"><span class="toc-number">7.1.</span> <span class="toc-text">7.1 表单元素兼容性处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-%E7%B2%98%E8%B4%B4%E5%81%8F%E7%A7%BB%E5%A4%84%E7%90%86"><span class="toc-number">7.2.</span> <span class="toc-text">7.2 粘贴偏移处理</span></a></li></ol></li></ol></div></div><footer><nobr><span class="icp-title">GZHU</span><span class="icp-content">193001-0001</span></nobr><br><nobr><span class="icp-title">OUTPOST</span><span class="icp-content">169-2025-0331</span></nobr><br><nobr>构建自 <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a></nobr><wbr><nobr> 使用主题 <a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknights</a></nobr><wbr><nobr> 主题作者 <a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plus</a></nobr></footer></aside></main><canvas id="canvas-dust"></canvas></body></html>