<!DOCTYPE html><html lang="en" theme-mode="dark"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>2025-11-23-canvas项目相关-工具栏选择机制 | Notes|笔记站</title><link rel="icon" type="image/x-icon" href="/Arknight-notes/favicon.ico"><link rel="preload" as="font" crossorigin="anonymous" href="/Arknight-notes/font/Bender.ttf"><link rel="preload" as="font" crossorigin="anonymous" href="/Arknight-notes/font/BenderLight.ttf"><link rel="preload" as="font" crossorigin="anonymous" href="/Arknight-notes/font/JetBrainsMono-Regular.woff2"><link rel="stylesheet" href="/Arknight-notes/css/arknights.css"><style>@font-face {
  font-family: Bender;
  src: local('Bender'), url("/Arknight-notes/font/Bender.ttf"), url("/Arknight-notes/font/Bender.otf");
}
@font-face {
  font-family: BenderLight;
  src: local('BenderLight'), url("/Arknight-notes/font/BenderLight.ttf");
}
@font-face {
  font-family: 'JetBrains Mono';
  src: local('JetBrains Mono'), url('/Arknight-notes/font/JetBrainsMono-Regular.woff2') format('woff2');
}
</style><script>var config = {"root":"/Arknight-notes/","code_fold":90,"search":{"preload":false,"activeHolder":"Enter here","blurHolder":"Search","noResult":"Data \"$0\" not found"},"code":{"codeInfo":"$0 - $1 lines","copy":"copy"}}</script><link type="text/css" rel="stylesheet" href="/Arknight-notes/lib/encrypt/hbe.style.css"><script src="/Arknight-notes/js/gitalk.js"></script><script src="//unpkg.com/mermaid@10.5.0/dist/mermaid.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.6.1/MathJax.js"></script><script>MathJax.Hub.Config({
 menuSettings: {
   zoom: "None"
 },
 showMathMenu: false,
 jax: ["input/TeX","output/CommonHTML"],
 extensions: ["tex2jax.js"],
 TeX: {
   extensions: ["AMSmath.js","AMSsymbols.js"],
   equationNumbers: {
     autoNumber: "AMS"
   }
 },
 tex2jax: {
   inlineMath: [["\\(", "\\)"]],
   displayMath: [["\\[", "\\]"]]
 }
});</script><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lightgallery.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-zoom.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-thumbnail.css"><link type="text/css" rel="stylesheet" href="/Arknight-notes/lib/fontawesome/css/all.min.css"><script>if (window.localStorage.getItem('theme-mode') === 'light')
 document.documentElement.setAttribute('theme-mode', 'light')
if (window.localStorage.getItem('theme-mode') === 'dark')
 document.documentElement.setAttribute('theme-mode', 'dark')</script><style>@font-face {
 font-family: BenderLight;
 src: local('Bender'), url("/Arknight-notes/font/BenderLight.woff2") format('woff2');
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/Arknight-notes/font/JetBrainsMono-Regular.woff2') format('woff2');
}</style><style>:root {
 --dark-background: url('https://pic2.zhimg.com/v2-6269d74b4dafe14781d03790e5a86b21_r.jpg');
 --light-background: url('https://pic1.zhimg.com/v2-233b64b583642fc4a6d77e69ced33150_r.jpg');
 --theme-encrypt-confirm: 'confirm'
}</style><script defer src="/Arknight-notes/js/arknights.js"></script><script defer src="/Arknight-notes/js/search.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script async src="/Arknight-notes/js/gitalk.js"></script><script defer type="module">import mermaid from '//unpkg.com/mermaid@10.5.0/dist/mermaid.esm.mjs';
window.mermaid = mermaid;
code.paintMermaid();
</script><script src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.6.1/MathJax.js"></script><script>MathJax.Hub.Config({
  menuSettings: {
    zoom: "None"
  },
  showMathMenu: false,
  jax: ["input/TeX","output/CommonHTML"],
  extensions: ["tex2jax.js"],
  TeX: {
    extensions: ["AMSmath.js","AMSsymbols.js"],
    equationNumbers: {
      autoNumber: "AMS"
    }
  },
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]]
  }
});
</script><script async src="//unpkg.com/lightgallery@2.7.1/lightgallery.min.js"></script><script async src="//unpkg.com/lightgallery@2.7.1/plugins/zoom/lg-zoom.min.js"></script><script async src="//unpkg.com/lightgallery@2.7.1/plugins/thumbnail/lg-thumbnail.min.js"></script><script async src="/Arknight-notes/lib/encrypt/hbe.js"></script><script async src="/Arknight-notes/js/pjax.js"></script><script class="pjax-js">reset= () => {gitalk = new Gitalk({
 clientID: 'Ov23ct13Fb0b67x23wnT',
 clientSecret: 'f18ce69dd545e3c0f5e2456afde9c756fe8a254a',
 repo: 'Arknight-notes',
 owner: 'Zhongye1',
 admin: ['Zhongye1'],
 distractionFreeMode: false,
 id: location.pathname
});
if (document.querySelector("#gitalk")) gitalk.render("gitalk");document.querySelector('.lg-container')?.remove()
lightGallery(document.getElementById('post-bg'), {
  plugins: [lgZoom,lgThumbnail],
  selector: '.item-img'})}</script><script>window.addEventListener("load",() => {pjax = new Pjax({
 cacheBust: false,
 selectors: ['title','article','#aside-block','.pjax-js','data-pjax','.busuanzi'],
 switches: {'article': Pjax.switches.sideBySide},
 switchesOptions: {
   'article': {
     classNames: {
       remove: "pjax-out",
       add: "pjax-in"
     }
   }
 }
});
document.addEventListener("pjax:complete", reset);document.addEventListener('pjax:success', _ => bszCaller.fetch(
 "//busuanzi.ibruce.info/busuanzi?jsonpCallback=BusuanziCallback", a => {
  bszTag.texts(a),
  bszTag.shows()
}));reset()})</script><script class="pjax-js">reset= () => {gitalk = new Gitalk({
 clientID: 'Ov23ct13Fb0b67x23wnT',
 clientSecret: 'f18ce69dd545e3c0f5e2456afde9c756fe8a254a',
 repo: 'Arknight-notes',
 owner: 'Zhongye1',
 admin: ['Zhongye1'],
 distractionFreeMode: false,
 id: location.pathname
});
if (document.querySelector("#gitalk")) gitalk.render("gitalk");document.querySelector('.lg-container')?.remove()
lightGallery(document.getElementById('post-bg'), {
  plugins: [lgZoom,lgThumbnail],
  selector: '.item-img'})}</script><script>window.addEventListener("load",() => {pjax = new Pjax({
 cacheBust: false,
 selectors: ['title','article','#aside-block','.pjax-js'],
 switches: {'article': Pjax.switches.sideBySide},
 switchesOptions: {
   'article': {
     classNames: {
       remove: "pjax-out",
       add: "pjax-in"
     }
   }
 }
});
document.addEventListener("pjax:complete", reset);reset()})</script><meta name="generator" content="Hexo 7.3.0"><style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style><link rel="alternate" href="/Arknight-notes/rss.xml" title="Notes|笔记站" type="application/atom+xml">
</head><body><div class="loading" style="opacity: 0;"><div class="loadingBar left"></div><div class="loadingBar right"></div></div><main><header class="closed"><div class="navBtn"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><nav><div class="navItem" id="search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="Search" spellcheck="false" maxlength="50" type="text" id="search-input"></span></div><div class="navItem" id="search-holder"></div><div class="search-popup" tabindex="0"><div id="search-result"></div></div><ol class="navContent"><li class="navItem"><a class="navBlock" href="/Arknight-notes/"><span class="navItemTitle">Home</span></a></li><li class="navItem" matchdata="categories,tags"><a class="navBlock" href="/Arknight-notes/archives/"><span class="navItemTitle">Archives</span></a></li><li class="navItem"><a class="navBlock" href="/Arknight-notes/about/"><span class="navItemTitle">About</span></a></li></ol></nav></header><article><div id="post-bg"><div id="post-title"><h1>2025-11-23-canvas项目相关-工具栏选择机制</h1><div id="post-info"><span>First Post: <div class="control"><time datetime="2025-11-23T11:48:44.000Z" id="date"> 2025-11-23</time></div></span><br><span>Last Update: <div class="control"><time datetime="2025-11-23T13:05:32.600Z" id="updated"> 2025-11-23</time></div></span><br><span id="busuanzi_container_page_pv">Page View: <span class="control" id="busuanzi_value_page_pv">loading...</span></span></div></div><hr><div id="post-content"><h1 id="项目工具栏模块"><a href="#项目工具栏模块" class="headerlink" title="项目工具栏模块"></a>项目工具栏模块</h1><p>工具栏提供用户界面以选择和切换不同的绘图工具，使用户能够在画布上执行各种操作，如选择、绘制、添加文本、插入图片等。它是用户与画布交互的主要入口之一。</p>
<h3 id="1-2-结构"><a href="#1-2-结构" class="headerlink" title="1.2 结构"></a>1.2 结构</h3><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs nix">src<span class="hljs-symbol">/</span><br>├── components<span class="hljs-symbol">/</span><br>│   └── canvas_toolbar<span class="hljs-symbol">/</span><br>│       └── TopToolbar.tsx        <span class="hljs-comment"># 顶部工具栏组件</span><br>├── stores<span class="hljs-symbol">/</span><br>│   └── canvasStore.ts            <span class="hljs-comment"># 全局状态管理，包含工具类型定义和切换方法</span><br>└── pages<span class="hljs-symbol">/</span><br>    └── canvas<span class="hljs-symbol">/</span><br>        └── Pixi_STM_modules<span class="hljs-symbol">/</span><br>            └── core<span class="hljs-symbol">/</span><br>                └── StageManagerCore.ts  <span class="hljs-comment"># 根据工具类型处理不同交互逻辑</span><br></code></pre></td></tr></table></figure>
<h3 id="1-3-DSF"><a href="#1-3-DSF" class="headerlink" title="1.3 DSF"></a>1.3 DSF</h3><ul>
<li>React：用于构建用户界面</li>
<li>TypeScript：提供类型安全</li>
<li>Zustand：全局状态管理</li>
<li>Tailwind CSS：样式设计</li>
<li>Lucide React：图标组件库</li>
</ul>
<h2 id="2-类型定义"><a href="#2-类型定义" class="headerlink" title="2. 类型定义"></a>2. 类型定义</h2><h3 id="2-1-工具类型定义"><a href="#2-1-工具类型定义" class="headerlink" title="2.1 工具类型定义"></a>2.1 工具类型定义</h3><p>在 <a href="/src/stores/canvasStore.ts">canvasStore.ts</a> 中定义了完整的工具类型：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">ToolType</span> =<br>  | <span class="hljs-string">"select"</span><br>  | <span class="hljs-string">"hand"</span><br>  | <span class="hljs-string">"rect"</span><br>  | <span class="hljs-string">"circle"</span><br>  | <span class="hljs-string">"triangle"</span><br>  | <span class="hljs-string">"diamond"</span><br>  | <span class="hljs-string">"line"</span><br>  | <span class="hljs-string">"arrow"</span><br>  | <span class="hljs-string">"pencil"</span><br>  | <span class="hljs-string">"text"</span><br>  | <span class="hljs-string">"image"</span><br>  | <span class="hljs-string">"eraser"</span>;<br></code></pre></td></tr></table></figure>
<p>在 <a href="/src/components/canvas_toolbar/TopToolbar.tsx">TopToolbar.tsx</a> 中也有一个局部的工具类型定义，但略有不同：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">ToolType</span> =<br>  | <span class="hljs-string">"select"</span><br>  | <span class="hljs-string">"hand"</span><br>  | <span class="hljs-string">"rect"</span><br>  | <span class="hljs-string">"diamond"</span><br>  | <span class="hljs-string">"circle"</span><br>  | <span class="hljs-string">"arrow"</span><br>  | <span class="hljs-string">"line"</span><br>  | <span class="hljs-string">"pencil"</span><br>  | <span class="hljs-string">"text"</span><br>  | <span class="hljs-string">"image"</span><br>  | <span class="hljs-string">"eraser"</span>;<br></code></pre></td></tr></table></figure>
<p>附：<a href="/src/components/canvas_toolbar/TopToolbar.tsx">TopToolbar.tsx</a> 中没有定义 <code>triangle</code> 类型，这个某天会改</p>
<h3 id="2-2-工具配置项定义"><a href="#2-2-工具配置项定义" class="headerlink" title="2.2 工具配置项定义"></a>2.2 工具配置项定义</h3><p>在 <a href="/src/components/canvas_toolbar/TopToolbar.tsx">TopToolbar.tsx</a> 中定义了工具配置项接口：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">ToolItemConfig</span> {<br>  <span class="hljs-attr">type</span>: <span class="hljs-title class_">ToolType</span> | <span class="hljs-string">"action"</span>; <span class="hljs-comment">// action 代表锁、库等非绘图工具</span><br>  <span class="hljs-attr">icon</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">ElementType</span>;<br>  <span class="hljs-attr">label</span>: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// 用于 tooltip</span><br>  <span class="hljs-attr">value</span>?: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// store 中的 tool 值</span><br>  <span class="hljs-attr">shortcut</span>?: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// 右下角快捷键提示</span><br>  <span class="hljs-attr">isSeparator</span>?: <span class="hljs-built_in">boolean</span>; <span class="hljs-comment">// 是否是分隔符</span><br>}<br></code></pre></td></tr></table></figure>
<h2 id="3-状态管理"><a href="#3-状态管理" class="headerlink" title="3. 状态管理"></a>3. 状态管理</h2><p>工具栏选择机制的核心状态存储在 canvasStore 中：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">CanvasState</span> {<br>  <span class="hljs-attr">tool</span>: <span class="hljs-title class_">ToolType</span>; <span class="hljs-comment">// 当前选中的工具类型</span><br>  <span class="hljs-comment">// ... 其他状态</span><br>}<br></code></pre></td></tr></table></figure>
<p>工具切换方法：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-attr">setTool</span>: <span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">tool</span>: <span class="hljs-title class_">ToolType</span></span>) =&gt;</span> <span class="hljs-built_in">void</span><br></code></pre></td></tr></table></figure>
<h2 id="4-工具分类与实现逻辑"><a href="#4-工具分类与实现逻辑" class="headerlink" title="4. 工具分类与实现逻辑"></a>4. 工具分类与实现逻辑</h2><h3 id="4-1-工具分类"><a href="#4-1-工具分类" class="headerlink" title="4.1 工具分类"></a>4.1 工具分类</h3><p>BDdraw 项目中的工具可以分为以下几类：</p>
<ol>
<li><p><strong>导航与选择工具</strong></p>
<ul>
<li>手形工具（hand）：用于拖动画布</li>
<li>选择工具（select）：用于选择和操作元素</li>
</ul>
</li>
<li><p><strong>绘图工具</strong></p>
<ul>
<li>矩形工具（rect）</li>
<li>菱形工具（diamond）</li>
<li>圆形工具（circle）</li>
<li>箭头工具（arrow）</li>
<li>直线工具（line）</li>
<li>铅笔工具（pencil）</li>
</ul>
</li>
<li><p><strong>特殊内容工具</strong></p>
<ul>
<li>文本工具（text）：用于添加和编辑文本</li>
<li>图片工具（image）：用于插入图片</li>
<li>橡皮擦工具（eraser）：用于删除元素</li>
</ul>
</li>
<li><p><strong>操作工具</strong></p>
<ul>
<li>撤销/重做工具：用于撤销或重做操作</li>
</ul>
</li>
</ol>
<h3 id="4-2-工具实现逻辑"><a href="#4-2-工具实现逻辑" class="headerlink" title="4.2 工具实现逻辑"></a>4.2 工具实现逻辑</h3><p>工具栏选择机制通过以下几套逻辑实现：</p>
<h4 id="4-2-1-工具栏-UI-渲染逻辑"><a href="#4-2-1-工具栏-UI-渲染逻辑" class="headerlink" title="4.2.1 工具栏 UI 渲染逻辑"></a>4.2.1 工具栏 UI 渲染逻辑</h4><p>工具栏在 <a href="/src/components/canvas_toolbar/TopToolbar.tsx">TopToolbar.tsx</a> 中定义，采用配置驱动的方式：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">const</span> tools = [<br>  {<br>    <span class="hljs-attr">id</span>: <span class="hljs-string">"lock"</span>,<br>    <span class="hljs-attr">type</span>: <span class="hljs-string">"action"</span>,<br>    <span class="hljs-attr">icon</span>: locked ? <span class="hljs-title class_">Lock</span> : <span class="hljs-title class_">Unlock</span>,<br>    <span class="hljs-attr">label</span>: locked ? <span class="hljs-string">"Unlock (Ctrl+Shift+L)"</span> : <span class="hljs-string">"Lock (Ctrl+Shift+L)"</span>,<br>    <span class="hljs-attr">onClick</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">setLocked</span>(!locked),<br>  },<br>  { <span class="hljs-attr">isSeparator</span>: <span class="hljs-literal">true</span> },<br>  {<br>    <span class="hljs-attr">id</span>: <span class="hljs-string">"hand"</span>,<br>    <span class="hljs-attr">value</span>: <span class="hljs-string">"hand"</span>,<br>    <span class="hljs-attr">icon</span>: <span class="hljs-title class_">Hand</span>,<br>    <span class="hljs-attr">label</span>: <span class="hljs-string">"Hand tool (H)"</span>,<br>    <span class="hljs-attr">shortcut</span>: <span class="hljs-string">""</span>,<br>  },<br>  {<br>    <span class="hljs-attr">id</span>: <span class="hljs-string">"select"</span>,<br>    <span class="hljs-attr">value</span>: <span class="hljs-string">"select"</span>,<br>    <span class="hljs-attr">icon</span>: <span class="hljs-title class_">MousePointer2</span>,<br>    <span class="hljs-attr">label</span>: <span class="hljs-string">"Selection (V)"</span>,<br>    <span class="hljs-attr">shortcut</span>: <span class="hljs-string">"1"</span>,<br>  },<br>  {<br>    <span class="hljs-attr">id</span>: <span class="hljs-string">"rect"</span>,<br>    <span class="hljs-attr">value</span>: <span class="hljs-string">"rect"</span>,<br>    <span class="hljs-attr">icon</span>: <span class="hljs-title class_">Square</span>,<br>    <span class="hljs-attr">label</span>: <span class="hljs-string">"Rectangle (R)"</span>,<br>    <span class="hljs-attr">shortcut</span>: <span class="hljs-string">"2"</span>,<br>  },<br>  {<br>    <span class="hljs-attr">id</span>: <span class="hljs-string">"diamond"</span>,<br>    <span class="hljs-attr">value</span>: <span class="hljs-string">"diamond"</span>,<br>    <span class="hljs-attr">icon</span>: <span class="hljs-title class_">Diamond</span>,<br>    <span class="hljs-attr">label</span>: <span class="hljs-string">"Diamond (D)"</span>,<br>    <span class="hljs-attr">shortcut</span>: <span class="hljs-string">"3"</span>,<br>  },<br>  {<br>    <span class="hljs-attr">id</span>: <span class="hljs-string">"circle"</span>,<br>    <span class="hljs-attr">value</span>: <span class="hljs-string">"circle"</span>,<br>    <span class="hljs-attr">icon</span>: <span class="hljs-title class_">Circle</span>,<br>    <span class="hljs-attr">label</span>: <span class="hljs-string">"Ellipse (E)"</span>,<br>    <span class="hljs-attr">shortcut</span>: <span class="hljs-string">"4"</span>,<br>  },<br>  {<br>    <span class="hljs-attr">id</span>: <span class="hljs-string">"arrow"</span>,<br>    <span class="hljs-attr">value</span>: <span class="hljs-string">"arrow"</span>,<br>    <span class="hljs-attr">icon</span>: <span class="hljs-title class_">ArrowRight</span>,<br>    <span class="hljs-attr">label</span>: <span class="hljs-string">"Arrow (A)"</span>,<br>    <span class="hljs-attr">shortcut</span>: <span class="hljs-string">"5"</span>,<br>  },<br>  { <span class="hljs-attr">id</span>: <span class="hljs-string">"line"</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">"line"</span>, <span class="hljs-attr">icon</span>: <span class="hljs-title class_">Minus</span>, <span class="hljs-attr">label</span>: <span class="hljs-string">"Line (L)"</span>, <span class="hljs-attr">shortcut</span>: <span class="hljs-string">"6"</span> },<br>  {<br>    <span class="hljs-attr">id</span>: <span class="hljs-string">"pencil"</span>,<br>    <span class="hljs-attr">value</span>: <span class="hljs-string">"pencil"</span>,<br>    <span class="hljs-attr">icon</span>: <span class="hljs-title class_">Pencil</span>,<br>    <span class="hljs-attr">label</span>: <span class="hljs-string">"Draw (P)"</span>,<br>    <span class="hljs-attr">shortcut</span>: <span class="hljs-string">"7"</span>,<br>  },<br>  { <span class="hljs-attr">id</span>: <span class="hljs-string">"text"</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">"text"</span>, <span class="hljs-attr">icon</span>: <span class="hljs-title class_">Type</span>, <span class="hljs-attr">label</span>: <span class="hljs-string">"Text (T)"</span>, <span class="hljs-attr">shortcut</span>: <span class="hljs-string">"8"</span> },<br>  {<br>    <span class="hljs-attr">id</span>: <span class="hljs-string">"image"</span>,<br>    <span class="hljs-attr">value</span>: <span class="hljs-string">"image"</span>,<br>    <span class="hljs-attr">icon</span>: <span class="hljs-title class_">ImageIcon</span>,<br>    <span class="hljs-attr">label</span>: <span class="hljs-string">"Insert image"</span>,<br>    <span class="hljs-attr">shortcut</span>: <span class="hljs-string">"9"</span>,<br>    <span class="hljs-attr">onClick</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">setImageModalVisible</span>(<span class="hljs-literal">true</span>),<br>  },<br>  {<br>    <span class="hljs-attr">id</span>: <span class="hljs-string">"eraser"</span>,<br>    <span class="hljs-attr">value</span>: <span class="hljs-string">"eraser"</span>,<br>    <span class="hljs-attr">icon</span>: <span class="hljs-title class_">Eraser</span>,<br>    <span class="hljs-attr">label</span>: <span class="hljs-string">"Eraser (E)"</span>,<br>    <span class="hljs-attr">shortcut</span>: <span class="hljs-string">"0"</span>,<br>  },<br>  { <span class="hljs-attr">isSeparator</span>: <span class="hljs-literal">true</span> },<br>  {<br>    <span class="hljs-attr">id</span>: <span class="hljs-string">"library"</span>,<br>    <span class="hljs-attr">type</span>: <span class="hljs-string">"action"</span>,<br>    <span class="hljs-attr">icon</span>: <span class="hljs-title class_">LayoutGrid</span>,<br>    <span class="hljs-attr">label</span>: <span class="hljs-string">"Library"</span>,<br>    <span class="hljs-attr">onClick</span>: <span class="hljs-function">() =&gt;</span><br>      <span class="hljs-title class_">Notification</span>.<span class="hljs-title function_">error</span>({<br>        <span class="hljs-attr">closable</span>: <span class="hljs-literal">false</span>,<br>        <span class="hljs-attr">title</span>: <span class="hljs-string">"DEV"</span>,<br>        <span class="hljs-attr">content</span>: <span class="hljs-string">"lib功能还没完善"</span>,<br>      }),<br>  },<br>];<br></code></pre></td></tr></table></figure>
<p>工具栏渲染逻辑：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs mermaid">graph TB<br>    A[渲染工具栏] --&gt; B[遍历工具配置]<br>    B --&gt; C{是否为分隔符?}<br>    C --&gt;|是| D[渲染分隔线]<br>    C --&gt;|否| E[渲染按钮]<br>    E --&gt; F{是否有自定义点击处理?}<br>    F --&gt;|是| G[执行自定义处理]<br>    F --&gt;|否| H[调用setTool设置工具]<br>    D --&gt; I[继续下一个工具]<br>    G --&gt; I<br>    H --&gt; I<br>    I --&gt; J{是否还有工具?}<br>    J --&gt;|是| B<br>    J --&gt;|否| K[渲染完成]<br></code></pre></td></tr></table></figure>
<h4 id="4-2-2-工具状态管理逻辑"><a href="#4-2-2-工具状态管理逻辑" class="headerlink" title="4.2.2 工具状态管理逻辑"></a>4.2.2 工具状态管理逻辑</h4><p>工具状态管理通过 Zustand 实现：</p>
<ol>
<li>在 <a href="/src/stores/canvasStore.ts">canvasStore.ts</a> 中定义工具状态和切换方法：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">CanvasState</span> {<br>  <span class="hljs-attr">tool</span>: <span class="hljs-title class_">ToolType</span><br>  <span class="hljs-comment">// ...</span><br>}<br><br><span class="hljs-attr">setTool</span>: <span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">tool</span>: <span class="hljs-title class_">ToolType</span></span>) =&gt;</span> <span class="hljs-built_in">void</span><br></code></pre></td></tr></table></figure>
<ol>
<li>实现工具切换方法：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-attr">setTool</span>: <span class="hljs-function">(<span class="hljs-params">tool</span>) =&gt;</span> <span class="hljs-title function_">originalSet</span>({ tool, <span class="hljs-attr">selectedIds</span>: [], <span class="hljs-attr">editingId</span>: <span class="hljs-literal">null</span> });<br></code></pre></td></tr></table></figure>
<p>每次切换工具时，都会清空当前选中的元素和正在编辑的元素 ID。</p>
<h4 id="4-2-3-工具交互逻辑"><a href="#4-2-3-工具交互逻辑" class="headerlink" title="4.2.3 工具交互逻辑"></a>4.2.3 工具交互逻辑</h4><p>工具交互逻辑在 <a href="/src/pages/canvas/Pixi_STM_modules/core/StageManagerCore.ts">StageManagerCore.ts</a> 中实现，根据当前工具类型处理不同的交互：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">private</span> onPointerDown = <span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">e</span>: PIXI.<span class="hljs-title class_">FederatedPointerEvent</span></span>) =&gt;</span> {<br>  <span class="hljs-comment">// ...</span><br>  <span class="hljs-keyword">const</span> tool = state.<span class="hljs-property">tool</span><br>  <span class="hljs-comment">// ...</span><br><br>  <span class="hljs-keyword">if</span> (tool === <span class="hljs-string">'hand'</span> || <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-property">isSpacePressed</span>) <span class="hljs-keyword">return</span><br><br>  <span class="hljs-comment">// 根据不同工具类型执行不同逻辑</span><br>  <span class="hljs-keyword">if</span> (tool === <span class="hljs-string">'eraser'</span>) {<br>    <span class="hljs-comment">// 橡皮擦逻辑</span><br>  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (tool === <span class="hljs-string">'text'</span>) {<br>    <span class="hljs-comment">// 文本工具逻辑</span><br>  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (e.<span class="hljs-property">target</span> &amp;&amp; e.<span class="hljs-property">target</span>.<span class="hljs-property">label</span> &amp;&amp; !e.<span class="hljs-property">target</span>.<span class="hljs-property">label</span>.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'handle:'</span>)) {<br>    <span class="hljs-comment">// 元素点击逻辑</span><br>  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (tool === <span class="hljs-string">'select'</span>) {<br>    <span class="hljs-comment">// 选择模式逻辑</span><br>  } <span class="hljs-keyword">else</span> {<br>    <span class="hljs-comment">// 绘制模式逻辑</span><br>  }<br>}<br></code></pre></td></tr></table></figure>
<h2 id="5-核心函数解析"><a href="#5-核心函数解析" class="headerlink" title="5. 核心函数解析"></a>5. 核心函数解析</h2><h3 id="5-1-TopToolbar-组件"><a href="#5-1-TopToolbar-组件" class="headerlink" title="5.1 TopToolbar 组件"></a>5.1 TopToolbar 组件</h3><p><a href="/src/components/canvas_toolbar/TopToolbar.tsx">TopToolbar.tsx</a> 是工具栏的主要实现组件：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">TopToolbar</span>(<span class="hljs-params"></span>) {<br>  <span class="hljs-keyword">const</span> { tool, setTool, undo, redo, canUndo, canRedo } = <span class="hljs-title function_">useStore</span>();<br>  <span class="hljs-keyword">const</span> [locked, setLocked] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);<br>  <span class="hljs-keyword">const</span> [imageModalVisible, setImageModalVisible] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);<br><br>  <span class="hljs-comment">// ...</span><br>}<br></code></pre></td></tr></table></figure>
<p>组件主要功能：</p>
<ol>
<li>从 store 获取当前工具状态</li>
<li>提供工具切换功能</li>
<li>提供撤销/重做按钮</li>
<li>处理图片插入模态框显示</li>
</ol>
<h3 id="5-2-工具按钮渲染逻辑"><a href="#5-2-工具按钮渲染逻辑" class="headerlink" title="5.2 工具按钮渲染逻辑"></a>5.2 工具按钮渲染逻辑</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs typescript">{<br>  tools.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">item, index</span>) =&gt;</span> {<br>    <span class="hljs-comment">// 渲染分隔线</span><br>    <span class="hljs-keyword">if</span> (item.<span class="hljs-property">isSeparator</span>) {<br>      <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{</span>`<span class="hljs-attr">sep-</span>${<span class="hljs-attr">index</span>}`} <span class="hljs-attr">className</span>=<span class="hljs-string">"mx-1 h-6 w-px bg-gray-200"</span> /&gt;</span></span>;<br>    }<br><br>    <span class="hljs-comment">// 渲染按钮</span><br>    <span class="hljs-keyword">const</span> isActive = tool === item.<span class="hljs-property">value</span> &amp;&amp; item.<span class="hljs-property">type</span> !== <span class="hljs-string">"action"</span>;<br>    <span class="hljs-keyword">const</span> <span class="hljs-title class_">Icon</span> = item.<span class="hljs-property">icon</span>;<br><br>    <span class="hljs-keyword">return</span> (<br>      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">key</span>=<span class="hljs-string">{item.id</span> || <span class="hljs-attr">index</span>}</span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">title</span>=<span class="hljs-string">{item.label}</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> {</span><br><span class="language-xml">          if (item.onClick) item.onClick();</span><br><span class="language-xml">          if (item.value) setTool(item.value as any);</span><br><span class="language-xml">        }}</span><br><span class="language-xml">        className={cls(</span><br><span class="language-xml">          "relative flex h-9 w-9 items-center justify-center transition-colors duration-100",</span><br><span class="language-xml">          // 选中状态：淡紫色背景，深紫色图标</span><br><span class="language-xml">          isActive</span><br><span class="language-xml">            ? "bg-violet-100 text-violet-700"</span><br><span class="language-xml">            : "bg-transparent text-gray-600 hover:bg-gray-100",</span><br><span class="language-xml">          // 锁的特殊样式</span><br><span class="language-xml">          item.id === "lock" &amp;&amp; locked ? "text-gray-900" : ""</span><br><span class="language-xml">        )}</span><br><span class="language-xml">      &gt;</span><br><span class="language-xml">        {Icon &amp;&amp; (</span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">Icon</span></span></span><br><span class="hljs-tag"><span class="language-xml">            <span class="hljs-attr">className</span>=<span class="hljs-string">{cls(</span>"<span class="hljs-attr">h-4</span> <span class="hljs-attr">w-4</span>", <span class="hljs-attr">item.value</span> === <span class="hljs-string">"line"</span> ? "<span class="hljs-attr">rotate-45</span>" <span class="hljs-attr">:</span> "")}</span></span><br><span class="hljs-tag"><span class="language-xml">            <span class="hljs-attr">strokeWidth</span>=<span class="hljs-string">{2}</span></span></span><br><span class="hljs-tag"><span class="language-xml">          /&gt;</span></span><br><span class="language-xml">        )}</span><br><span class="language-xml"></span><br><span class="language-xml">        {/* 右下角的快捷键数字 */}</span><br><span class="language-xml">        {item.shortcut &amp;&amp; (</span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"absolute bottom-[2px] right-[2px] text-[9px] font-medium leading-none opacity-50"</span>&gt;</span></span><br><span class="language-xml">            {item.shortcut}</span><br><span class="language-xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="language-xml">        )}</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br>    );<br>  });<br>}<br></code></pre></td></tr></table></figure>
<h3 id="5-3-工具切换逻辑"><a href="#5-3-工具切换逻辑" class="headerlink" title="5.3 工具切换逻辑"></a>5.3 工具切换逻辑</h3><p>工具切换通过调用 store 的 <a href="/src/stores/canvasStore.ts#L255-L255">setTool</a> 方法实现：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-attr">setTool</span>: <span class="hljs-function">(<span class="hljs-params">tool</span>) =&gt;</span> <span class="hljs-title function_">originalSet</span>({ tool, <span class="hljs-attr">selectedIds</span>: [], <span class="hljs-attr">editingId</span>: <span class="hljs-literal">null</span> });<br></code></pre></td></tr></table></figure>
<h2 id="6-特殊工具处理"><a href="#6-特殊工具处理" class="headerlink" title="6. 特殊工具处理"></a>6. 特殊工具处理</h2><h3 id="6-1-图片工具"><a href="#6-1-图片工具" class="headerlink" title="6.1 图片工具"></a>6.1 图片工具</h3><p>图片工具与其他工具不同，它不直接在画布上创建元素，而是打开一个模态框让用户选择图片：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs typescript">{<br>  <span class="hljs-attr">id</span>: <span class="hljs-string">'image'</span>,<br>  <span class="hljs-attr">value</span>: <span class="hljs-string">'image'</span>,<br>  <span class="hljs-attr">icon</span>: <span class="hljs-title class_">ImageIcon</span>,<br>  <span class="hljs-attr">label</span>: <span class="hljs-string">'Insert image'</span>,<br>  <span class="hljs-attr">shortcut</span>: <span class="hljs-string">'9'</span>,<br>  <span class="hljs-attr">onClick</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">setImageModalVisible</span>(<span class="hljs-literal">true</span>),<br>}<br></code></pre></td></tr></table></figure>
<h3 id="6-2-锁定工具"><a href="#6-2-锁定工具" class="headerlink" title="6.2 锁定工具"></a>6.2 锁定工具</h3><p>锁定工具是一个特殊操作工具，用于锁定/解锁画布：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs typescript">{<br>  <span class="hljs-attr">id</span>: <span class="hljs-string">'lock'</span>,<br>  <span class="hljs-attr">type</span>: <span class="hljs-string">'action'</span>,<br>  <span class="hljs-attr">icon</span>: locked ? <span class="hljs-title class_">Lock</span> : <span class="hljs-title class_">Unlock</span>,<br>  <span class="hljs-attr">label</span>: locked ? <span class="hljs-string">'Unlock (Ctrl+Shift+L)'</span> : <span class="hljs-string">'Lock (Ctrl+Shift+L)'</span>,<br>  <span class="hljs-attr">onClick</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">setLocked</span>(!locked),<br>}<br></code></pre></td></tr></table></figure>
<h3 id="6-3-库工具"><a href="#6-3-库工具" class="headerlink" title="6.3 库工具"></a>6.3 库工具</h3><p>库工具是一个占位符，目前尚未实现：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs typescript">{<br>  <span class="hljs-attr">id</span>: <span class="hljs-string">'library'</span>,<br>  <span class="hljs-attr">type</span>: <span class="hljs-string">'action'</span>,<br>  <span class="hljs-attr">icon</span>: <span class="hljs-title class_">LayoutGrid</span>,<br>  <span class="hljs-attr">label</span>: <span class="hljs-string">'Library'</span>,<br>  <span class="hljs-attr">onClick</span>: <span class="hljs-function">() =&gt;</span><br>    <span class="hljs-title class_">Notification</span>.<span class="hljs-title function_">error</span>({<br>      <span class="hljs-attr">closable</span>: <span class="hljs-literal">false</span>,<br>      <span class="hljs-attr">title</span>: <span class="hljs-string">'DEV'</span>,<br>      <span class="hljs-attr">content</span>: <span class="hljs-string">'lib功能还没完善'</span>,<br>    }),<br>}<br></code></pre></td></tr></table></figure>
<h2 id="7-工具交互实现"><a href="#7-工具交互实现" class="headerlink" title="7. 工具交互实现"></a>7. 工具交互实现</h2><p>不同工具在 <a href="/src/pages/canvas/Pixi_STM_modules/core/StageManagerCore.ts">StageManagerCore.ts</a> 中有不同的交互实现：</p>
<h3 id="7-1-选择工具-select"><a href="#7-1-选择工具-select" class="headerlink" title="7.1 选择工具 (select)"></a>7.1 选择工具 (select)</h3><p>选择工具用于选择和操作画布上的元素：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">if</span> (tool === <span class="hljs-string">"select"</span>) {<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-property">mode</span> = <span class="hljs-string">"selecting"</span>;<br>  state.<span class="hljs-title function_">setSelected</span>([]);<br>  <span class="hljs-keyword">return</span>;<br>}<br></code></pre></td></tr></table></figure>
<h3 id="7-2-手形工具-hand"><a href="#7-2-手形工具-hand" class="headerlink" title="7.2 手形工具 (hand)"></a>7.2 手形工具 (hand)</h3><p>手形工具用于拖动画布：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">if</span> (tool === <span class="hljs-string">"hand"</span> || <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-property">isSpacePressed</span>) <span class="hljs-keyword">return</span>;<br></code></pre></td></tr></table></figure>
<h3 id="7-3-绘图工具-rect-circle-diamond-arrow-line-pencil"><a href="#7-3-绘图工具-rect-circle-diamond-arrow-line-pencil" class="headerlink" title="7.3 绘图工具 (rect, circle, diamond, arrow, line, pencil)"></a>7.3 绘图工具 (rect, circle, diamond, arrow, line, pencil)</h3><p>这些工具用于在画布上绘制相应形状：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// Drawing Mode</span><br><span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-property">mode</span> = <span class="hljs-string">"drawing"</span>;<br><span class="hljs-keyword">const</span> newId = <span class="hljs-title function_">nanoid</span>();<br><span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-property">currentId</span> = newId;<br><span class="hljs-comment">// ... 创建元素配置</span><br>state.<span class="hljs-title function_">addElement</span>(commonProps);<br></code></pre></td></tr></table></figure>
<h3 id="7-4-文本工具-text"><a href="#7-4-文本工具-text" class="headerlink" title="7.4 文本工具 (text)"></a>7.4 文本工具 (text)</h3><p>文本工具用于添加文本元素：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">if</span> (tool === <span class="hljs-string">"text"</span>) {<br>  <span class="hljs-keyword">const</span> newId = <span class="hljs-title function_">nanoid</span>();<br>  state.<span class="hljs-title function_">addElement</span>({<br>    <span class="hljs-attr">id</span>: newId,<br>    <span class="hljs-attr">type</span>: <span class="hljs-string">"text"</span>,<br>    <span class="hljs-attr">x</span>: worldPos.<span class="hljs-property">x</span>,<br>    <span class="hljs-attr">y</span>: worldPos.<span class="hljs-property">y</span>,<br>    <span class="hljs-attr">width</span>: <span class="hljs-number">200</span>,<br>    <span class="hljs-attr">height</span>: <span class="hljs-number">40</span>,<br>    <span class="hljs-attr">fill</span>: <span class="hljs-string">"#000000"</span>,<br>    <span class="hljs-attr">stroke</span>: <span class="hljs-string">"#000000"</span>,<br>    <span class="hljs-attr">strokeWidth</span>: <span class="hljs-number">0</span>,<br>    <span class="hljs-attr">text</span>: <span class="hljs-string">"&lt;p&gt;请输入文本&lt;/p&gt;"</span>,<br>    <span class="hljs-attr">fontSize</span>: state.<span class="hljs-property">currentStyle</span>.<span class="hljs-property">fontSize</span> || <span class="hljs-number">20</span>,<br>    <span class="hljs-attr">fontFamily</span>: state.<span class="hljs-property">currentStyle</span>.<span class="hljs-property">fontFamily</span> || <span class="hljs-string">"Arial"</span>,<br>  });<br>  state.<span class="hljs-title function_">setSelected</span>([newId]);<br>  state.<span class="hljs-title function_">setTool</span>(<span class="hljs-string">"select"</span>);<br>  <span class="hljs-keyword">return</span>;<br>}<br></code></pre></td></tr></table></figure>
<h3 id="7-5-橡皮擦工具-eraser"><a href="#7-5-橡皮擦工具-eraser" class="headerlink" title="7.5 橡皮擦工具 (eraser)"></a>7.5 橡皮擦工具 (eraser)</h3><p>橡皮擦工具用于删除元素：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">if</span> (tool === <span class="hljs-string">"eraser"</span>) {<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-property">mode</span> = <span class="hljs-string">"erasing"</span>;<br>  <span class="hljs-keyword">if</span> (e.<span class="hljs-property">target</span> &amp;&amp; e.<span class="hljs-property">target</span>.<span class="hljs-property">label</span>) {<br>    <span class="hljs-keyword">const</span> hitId = e.<span class="hljs-property">target</span>.<span class="hljs-property">label</span>;<br>    state.<span class="hljs-title function_">removeElements</span>([hitId]);<br>  }<br>  <span class="hljs-keyword">return</span>;<br>}<br></code></pre></td></tr></table></figure>
<div id="paginator"></div></div><div id="post-footer"><div id="pages"><div class="footer-link" style="width: 50%;text-align:right;border-right:1px #fe2 solid"><a href="/Arknight-notes/posts/25119.html">← Next 2025-11-23-canvas项目相关-快捷键管理</a></div><div class="footer-link" style="width: 50%;right:1px;border-left:1px #fe2 solid"><a href="/Arknight-notes/posts/52695.html">2025-11-23-Undo/Redo机制具体实现 Prev →</a></div></div></div><div id="comments"><div id="gitalk"></div></div></div><div class="bottom-btn"><div><a class="i-top" id="to-top" onClick="scrolls.scrolltop();" title="To Top" style="opacity: 0; display: none;">∧ </a><a class="i-index" id="to-index" href="#toc-div" title="To Catalog">≡</a><a class="i-color" id="color-mode" onClick="colorMode.change()" title="Change Theme"></a></div></div></article><aside><div id="about"><a href="/Arknight-notes/" id="logo"><img src="https://pic4.zhimg.com/80/v2-d9884f32711e19e80979eac58e943897_720w.webp" alt="Logo" style="margin:20;border-radius:0;"></a><h1 id="Dr"><a href="zhongye">柊野</a></h1><div id="description"><p></p></div></div><div id="aside-block"><div id="toc-div"><h1>Catalog</h1><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E5%B7%A5%E5%85%B7%E6%A0%8F%E6%A8%A1%E5%9D%97"><span class="toc-number">1.</span> <span class="toc-text">项目工具栏模块</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E7%BB%93%E6%9E%84"><span class="toc-number">1.0.1.</span> <span class="toc-text">1.2 结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-DSF"><span class="toc-number">1.0.2.</span> <span class="toc-text">1.3 DSF</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E7%B1%BB%E5%9E%8B%E5%AE%9A%E4%B9%89"><span class="toc-number">1.1.</span> <span class="toc-text">2. 类型定义</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E5%B7%A5%E5%85%B7%E7%B1%BB%E5%9E%8B%E5%AE%9A%E4%B9%89"><span class="toc-number">1.1.1.</span> <span class="toc-text">2.1 工具类型定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E5%B7%A5%E5%85%B7%E9%85%8D%E7%BD%AE%E9%A1%B9%E5%AE%9A%E4%B9%89"><span class="toc-number">1.1.2.</span> <span class="toc-text">2.2 工具配置项定义</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86"><span class="toc-number">1.2.</span> <span class="toc-text">3. 状态管理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E5%B7%A5%E5%85%B7%E5%88%86%E7%B1%BB%E4%B8%8E%E5%AE%9E%E7%8E%B0%E9%80%BB%E8%BE%91"><span class="toc-number">1.3.</span> <span class="toc-text">4. 工具分类与实现逻辑</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E5%B7%A5%E5%85%B7%E5%88%86%E7%B1%BB"><span class="toc-number">1.3.1.</span> <span class="toc-text">4.1 工具分类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E5%B7%A5%E5%85%B7%E5%AE%9E%E7%8E%B0%E9%80%BB%E8%BE%91"><span class="toc-number">1.3.2.</span> <span class="toc-text">4.2 工具实现逻辑</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-1-%E5%B7%A5%E5%85%B7%E6%A0%8F-UI-%E6%B8%B2%E6%9F%93%E9%80%BB%E8%BE%91"><span class="toc-number">1.3.2.1.</span> <span class="toc-text">4.2.1 工具栏 UI 渲染逻辑</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-2-%E5%B7%A5%E5%85%B7%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86%E9%80%BB%E8%BE%91"><span class="toc-number">1.3.2.2.</span> <span class="toc-text">4.2.2 工具状态管理逻辑</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-3-%E5%B7%A5%E5%85%B7%E4%BA%A4%E4%BA%92%E9%80%BB%E8%BE%91"><span class="toc-number">1.3.2.3.</span> <span class="toc-text">4.2.3 工具交互逻辑</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E6%A0%B8%E5%BF%83%E5%87%BD%E6%95%B0%E8%A7%A3%E6%9E%90"><span class="toc-number">1.4.</span> <span class="toc-text">5. 核心函数解析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-TopToolbar-%E7%BB%84%E4%BB%B6"><span class="toc-number">1.4.1.</span> <span class="toc-text">5.1 TopToolbar 组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-%E5%B7%A5%E5%85%B7%E6%8C%89%E9%92%AE%E6%B8%B2%E6%9F%93%E9%80%BB%E8%BE%91"><span class="toc-number">1.4.2.</span> <span class="toc-text">5.2 工具按钮渲染逻辑</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-%E5%B7%A5%E5%85%B7%E5%88%87%E6%8D%A2%E9%80%BB%E8%BE%91"><span class="toc-number">1.4.3.</span> <span class="toc-text">5.3 工具切换逻辑</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E7%89%B9%E6%AE%8A%E5%B7%A5%E5%85%B7%E5%A4%84%E7%90%86"><span class="toc-number">1.5.</span> <span class="toc-text">6. 特殊工具处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-%E5%9B%BE%E7%89%87%E5%B7%A5%E5%85%B7"><span class="toc-number">1.5.1.</span> <span class="toc-text">6.1 图片工具</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-%E9%94%81%E5%AE%9A%E5%B7%A5%E5%85%B7"><span class="toc-number">1.5.2.</span> <span class="toc-text">6.2 锁定工具</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-%E5%BA%93%E5%B7%A5%E5%85%B7"><span class="toc-number">1.5.3.</span> <span class="toc-text">6.3 库工具</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E5%B7%A5%E5%85%B7%E4%BA%A4%E4%BA%92%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.6.</span> <span class="toc-text">7. 工具交互实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-%E9%80%89%E6%8B%A9%E5%B7%A5%E5%85%B7-select"><span class="toc-number">1.6.1.</span> <span class="toc-text">7.1 选择工具 (select)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-%E6%89%8B%E5%BD%A2%E5%B7%A5%E5%85%B7-hand"><span class="toc-number">1.6.2.</span> <span class="toc-text">7.2 手形工具 (hand)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-3-%E7%BB%98%E5%9B%BE%E5%B7%A5%E5%85%B7-rect-circle-diamond-arrow-line-pencil"><span class="toc-number">1.6.3.</span> <span class="toc-text">7.3 绘图工具 (rect, circle, diamond, arrow, line, pencil)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-4-%E6%96%87%E6%9C%AC%E5%B7%A5%E5%85%B7-text"><span class="toc-number">1.6.4.</span> <span class="toc-text">7.4 文本工具 (text)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-5-%E6%A9%A1%E7%9A%AE%E6%93%A6%E5%B7%A5%E5%85%B7-eraser"><span class="toc-number">1.6.5.</span> <span class="toc-text">7.5 橡皮擦工具 (eraser)</span></a></li></ol></li></ol></li></ol></div></div><footer><nobr><span class="icp-title">GZHU</span><span class="icp-content">193001-0001</span></nobr><br><nobr><span class="icp-title">OUTPOST</span><span class="icp-content">169-2025-0331</span></nobr><br><nobr>Published with <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a></nobr><wbr><nobr> Theme <a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknights</a></nobr><wbr><nobr> by <a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plus</a></nobr></footer></aside></main><canvas id="canvas-dust"></canvas></body></html>